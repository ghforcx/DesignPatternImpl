# 命令模式

命令模式（Command）是指，把请求封装成一个命令，并传给调用对象。调用对象寻找可以处理该命令的合适的对象，并把该命令传给相应的对象，该对象执行命令。

### 优缺点

命令模式的优点：

- 降低系统的耦合度。
- 新的命令可以很容易地加入到系统中。
- 可以比较容易地设计一个命令队列和宏命令（组合命令）。
- 可以方便地实现对请求的Undo和Redo。

命令模式的缺点：

- 使用命令模式可能会导致某些系统有过多的具体命令类。因为针对每一个命令都需要设计一个具体命令类，因此某些系统可能需要大量具体命令类，这将影响命令模式的使用。

### 应用示例

例如在文本编辑器中，需要实现 Undo 和 Redo 操作，为实现这两种操作，如果直接进行修改，则过于复杂。例如在进行 undo 操作时，需要知道上一个操作具体是什么，如果是插入，那就删除插入的内容；如果是修改了格式，那就再将格式改回去。可见直接实现是一种高耦合的实现方式，需要知道具体的命令。

而如果使用命令模式，那么就会简化很多。设置通用的命令接口，然后维护两个双向队列，分别用于 Undo 和 Redo 操作即可。

`EditorDemoTest` 中演示了一个示例，用 `"123"` 初始化编辑器，在 `1` 后面插入 `a` ，再进行 undo 和 redo 操作，结果如下：

```text
123
1a23
123
1a23
```

可见可以正常执行。

### 其他应用场景

- 多级undo操作；
- 事务：通过使用命令模式进行封装，并配合回滚操作，可以较为简单地实现事务的原子性；
- 状态条：每个命令都提供一个任务量的估计，即可较为简单的估计状态总量，并显示合适的状态条；
- GUI编程：将每个按钮封装为一个命令；
- 前后端分离：前端通过 API 调用后端的服务，即可实现调用者与执行者的分离；
- 线程池：将 `Callable` 对象视为命令，则线程池可以认为是命令模式。

# 参考资料

- https://blog.csdn.net/zdsicecoco/article/details/51332440
- https://www.liaoxuefeng.com/wiki/1252599548343744/1281319491338273
- https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/command.html